jQuery.extend({createUploadIframe:function(b,a){var d="jUploadFrame"+b,c='<iframe id="'+d+'" name="'+d+'" style="position:absolute; top:-9999px; left:-9999px"';window.ActiveXObject&&("boolean"==typeof a?c+=' src="javascript:false"':"string"==typeof a&&(c+=' src="'+a+'"'));jQuery(c+" />").appendTo(document.body);return jQuery("#"+d).get(0)},createUploadForm:function(b,a,d){var c="jUploadForm"+b;b="jUploadFile"+b;c=jQuery('<form  action="" method="POST" name="'+c+'" id="'+c+'" enctype="multipart/form-data"></form>');
if(d)for(var g in d)jQuery('<input type="hidden" name="'+g+'" value="'+d[g]+'" />').appendTo(c);a=jQuery("#"+a);d=jQuery(a).clone();jQuery(a).attr("id",b);jQuery(a).before(d);jQuery(a).appendTo(c);jQuery(c).css("position","absolute");jQuery(c).css("top","-1200px");jQuery(c).css("left","-1200px");jQuery(c).appendTo("body");return c},ajaxFileUpload:function(b){b=jQuery.extend({},jQuery.ajaxSettings,b);var a=(new Date).getTime(),d=jQuery.createUploadForm(a,b.fileElementId,"undefined"==typeof b.data?
!1:b.data);jQuery.createUploadIframe(a,b.secureuri);var c="jUploadFrame"+a,a="jUploadForm"+a;b.global&&!jQuery.active++&&jQuery.event.trigger("ajaxStart");var g=!1,f={};b.global&&jQuery.event.trigger("ajaxSend",[f,b]);var e=function(a){var e=document.getElementById(c);try{e.contentWindow?(f.responseText=e.contentWindow.document.body?e.contentWindow.document.body.innerHTML:null,f.responseXML=e.contentWindow.document.XMLDocument?e.contentWindow.document.XMLDocument:e.contentWindow.document):e.contentDocument&&
(f.responseText=e.contentDocument.document.body?e.contentDocument.document.body.innerHTML:null,f.responseXML=e.contentDocument.document.XMLDocument?e.contentDocument.document.XMLDocument:e.contentDocument.document)}catch(h){jQuery.handleError(b,f,null,h)}if(f||"timeout"==a){g=!0;var m;try{if(m="timeout"!=a?"success":"error","error"!=m){var k=jQuery.uploadHttpData(f,b.dataType);b.success&&b.success(k,m);b.global&&jQuery.event.trigger("ajaxSuccess",[f,b])}else jQuery.handleError(b,f,m)}catch(n){m="error",
jQuery.handleError(b,f,m,n)}b.global&&jQuery.event.trigger("ajaxComplete",[f,b]);b.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop");b.complete&&b.complete(f,m);jQuery(e).unbind();setTimeout(function(){try{jQuery(e).remove(),jQuery(d).remove()}catch(a){jQuery.handleError(b,f,null,a)}},100);f=null}};0<b.timeout&&setTimeout(function(){g||e("timeout")},b.timeout);try{d=jQuery("#"+a),jQuery(d).attr("action",b.url),jQuery(d).attr("method","POST"),jQuery(d).attr("target",c),d.encoding?jQuery(d).attr("encoding",
"multipart/form-data"):jQuery(d).attr("enctype","multipart/form-data"),jQuery(d).submit()}catch(h){jQuery.handleError(b,f,null,h)}jQuery("#"+c).load(e);return{abort:function(){}}},uploadHttpData:function(b,a){var d;d="xml"==a||!a?b.responseXML:b.responseText;"script"==a&&jQuery.globalEval(d);"json"==a&&eval("data = "+d);"html"==a&&jQuery("<div>").html(d).evalScripts();return d}});var IN_SAE=!1,SERVER_URL=IN_SAE?"http://ahutlesson.sinaapp.com":"http://localhost/lesson/";function getAvatarURL(b,a){return a?IN_SAE?"http://ahutlesson-upload.stor.sinaapp.com/avatar/"+b+".jpg":"http://localhost/lesson/upload/avatar/"+b+".jpg":"static/img/noavatar.jpg"}function toggleSaveCookie(){var b=$("#save_cookie");b.attr("checked",!b.attr("checked"))}
function login(){var b=$("#login_xh").val(),a=$("#login_password").val(),d=$("#save_cookie").attr("checked");$.post("api/user.handler.php?act=login",{x:b,p:a}).done(function(a){0==a.lastIndexOf("0",0)?(d?$.cookie("ck",a.substr(2),{expires:30}):$.cookie("ck",a.substr(2)),window.location.reload()):0==a.lastIndexOf("1",0)&&alert(a.substr(2))})}function loginOut(){$.removeCookie("ck");window.location.reload()}
function atToday(b){var a=new Date;return b.getFullYear()==a.getFullYear()&&b.getMonth()==a.getMonth()&&b.getDate()==a.getDate()}function atThisYear(b){var a=new Date;return b.getFullYear()==a.getFullYear()}function strtotime(b){var a=b.split(" ");b=a[1];a=a[0].split("-");b=b.split(":");return new Date(a[0]-0,a[1]-0-1,a[2]-0,b[0]-0,b[1]-0,b[2]-0)}var origin_title="",logged_uxh="",unreadMessageCount=0,unreadNoticeCount=0;function isInt(b){return 0==b%1}
function checkUnreadMessage(){$.getJSON("api/notice.handler.php?act=getunreadcount&uxh="+logged_uxh,function(b){unreadMessageCount=b[0];unreadNoticeCount=b[1];refreshUnreadCount()})}
function refreshUnreadCount(){""==origin_title&&(origin_title=document.title);var b="";0!=unreadMessageCount?($(".unreadMessageCount").html('<a title="'+unreadMessageCount+'\u6761\u65b0\u6d88\u606f" href="message.php">('+unreadMessageCount+")</a>"),b+=unreadMessageCount+"\u6761\u65b0\u6d88\u606f"):$(".unreadMessageCount").html("");0!=unreadNoticeCount?(""!=b&&(b+="\uff0c"),b+=unreadNoticeCount+"\u6761\u65b0\u63d0\u9192",$(".unreadNoticeCount").html('<a title="'+unreadNoticeCount+'\u6761\u65b0\u63d0\u9192" href="notice.php">('+
unreadNoticeCount+")</a>")):$(".unreadNoticeCount").html("");document.title=""!=b?"\u3010"+b+"\u3011"+origin_title:origin_title}var sendpm_uxh="";function showPmdiv(b,a){sendpm_uxh=b;$("#pm_uname").html(a);$(".pmdiv").fadeIn(500)}
function sendpm(){var b=sendpm_uxh,a=$("#pm_title").val(),d=$("#pm_content").val();""==a.length||""==d.length?alert("\u6807\u9898\u6216\u5185\u5bb9\u4e3a\u7a7a\uff01"):$.post("api/notice.handler.php?act=sendmessage",{u:b,t:a,c:d}).done(function(){$("#pm_title").val("");$("#pm_content").val("");$(".pmdiv").fadeOut(500)})}$.ajaxSetup({cache:!1});function loadForumPage(b){$.getJSON("api/getforum.php?page="+b,function(a){totalThreads=a[0];currentPage=b;showForum(a[1])})}
function showForum(b){for(var a="",d=0;d<b.length;d++){var c=b[d],g=new strtotime(c.lastreply_time),f=g.getMonth()+1,e="",e=g.getMinutes();1==e.toString().length&&(e="0"+e);e=atToday(g)?g.getHours()+":"+e:atThisYear(g)?f+"-"+g.getDate():g.getFullYear()+"-"+f+"-"+g.getDate();a+='<div class="threadlist_wrap">';a+='<div class="lesson"><a target="_blank" title="'+c.lessonname+"("+c.teachername+')" href="lesson.php?lid='+c.lid+'">'+c.lessonname+"("+c.teachername+")</a></div>";a+='<div class="number">'+
c.view+"</div>";a+='<div class="number">'+c.reply+"</div>";a+='<div class="title"><a target="_blank" href="thread.php?tid='+c.tid+'">'+c.subject+"</a></div>";a+='<div class="author"><a target="_blank" href="user.php?uxh='+c.uxh+'">'+c.uname+"</a></div>";a+='<div class="lastreply">'+e+' <a target="_blank" href="user.php?uxh='+c.lastreply_uxh+'">'+c.lastreply_uname+"</a></div>";is_admin&&(a+='<div class="admin"><a class="clickable" onclick="deleteForumThread('+c.tid+');">\u5220\u9664</a></div>');a+=
'<div class="clear"></div>';a+="</div>"}$("#threadlist").html(a);totalPages=Math.floor((totalThreads-1)/threadsPerPage+1);b="";d=1;a=totalPages;c=!1;5<currentPage&&(b=b+'<span class="button" onclick="jumpToForumPage(1)">\u9996\u9875</span>'+('<span class="button" onclick="jumpToForumPage('+(currentPage-1)+')">\u4e0a\u4e00\u9875</span>'),d=currentPage-4);9<a-d&&(c=!0,a=d+9);for(;d<=a;d++)b=d!=currentPage?b+('<span class="button" onclick="jumpToForumPage('+d+')">'+d+"</span>"):b+('<span class="normal" >'+
d+"</span>");c&&(b+='<span class="button" onclick="jumpToForumPage('+(currentPage+1)+')">\u4e0b\u4e00\u9875</span>',b+='<span class="button" onclick="jumpToForumPage('+totalPages+')">\u5c3e\u9875</span>');$("#pager").html(b);$("#threadsnum").html("\u5171"+totalPages+"\u9875 \u5171\u6709\u4e3b\u9898\u6570:"+totalThreads)}function jumpToForumPage(b){$.getJSON("api/getforum.php?lid="+lid+"&page="+b,function(a){totalThreads=a[0];currentPage=b;showForum(a[1]);$("#threadlist").ScrollTo()})}
function refreshForum(){loadPage(currentPage)}function deleteForumThread(b){confirm("\u786e\u5b9a\u5220\u9664\u5e16\u5b50\uff1f\uff08ID:"+b+"\uff09")&&$.get("api/thread.handler.php?act=delete&tid="+b,function(a){0==a.lastIndexOf("0",0)?refreshForum():0==a.lastIndexOf("1",0)&&alert(a.substr(2))})};(function(b){"function"===typeof define&&define.amd&&define.amd.jQuery?define(["jquery"],b):b(jQuery)})(function(b){function a(a){return a}function d(a){return decodeURIComponent(a.replace(g," "))}function c(a){0===a.indexOf('"')&&(a=a.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));return f.json?JSON.parse(a):a}var g=/\+/g,f=b.cookie=function(e,h,g){if(void 0!==h){g=b.extend({},f.defaults,g);if("number"===typeof g.expires){var j=g.expires,l=g.expires=new Date;l.setDate(l.getDate()+j)}h=f.json?
JSON.stringify(h):String(h);return document.cookie=[encodeURIComponent(e),"=",f.raw?h:encodeURIComponent(h),g.expires?"; expires="+g.expires.toUTCString():"",g.path?"; path="+g.path:"",g.domain?"; domain="+g.domain:"",g.secure?"; secure":""].join("")}h=f.raw?a:d;g=document.cookie.split("; ");for(var j=e?void 0:{},l=0,m=g.length;l<m;l++){var k=g[l].split("="),n=h(k.shift()),k=h(k.join("="));if(e&&e===n){j=c(k);break}e||(j[n]=c(k))}return j};f.defaults={};b.removeCookie=function(a,c){return void 0!==
b.cookie(a)?(b.cookie(a,"",b.extend(c,{expires:-1})),!0):!1}});/*
 MIT License {@link http://creativecommons.org/licenses/MIT/}
*/
(function(b,a){var d,c;d=b.jQuery;c=d.ScrollTo=d.ScrollTo||{config:{duration:400,easing:"swing",callback:a,durationMode:"each",offsetTop:0,offsetLeft:0},configure:function(a){d.extend(c.config,a||{});return this},scroll:function(a,f){var e,h,p,j,l,m,k,n,q,r;e=a.pop();h=e.$container;p=h.get(0);j=e.$target;l=d("<span/>").css({position:"absolute",top:"0px",left:"0px"});m=h.css("position");h.css("position","relative");l.appendTo(h);e=l.offset().top;e=j.offset().top-e-parseInt(f.offsetTop,10);k=l.offset().left;
n=j.offset().left-k-parseInt(f.offsetLeft,10);j=p.scrollTop;k=p.scrollLeft;l.remove();h.css("position",m);q={};r=function(b){0===a.length?"function"===typeof f.callback&&f.callback.apply(this,[b]):c.scroll(a,f);return!0};f.onlyIfOutside&&(l=j+h.height(),m=k+h.width(),j<e&&e<l&&(e=j),k<n&&n<m&&(n=k));e!==j&&(q.scrollTop=e);n!==k&&(q.scrollLeft=n);d.browser.safari&&p===document.body?(b.scrollTo(q.scrollLeft,q.scrollTop),r()):q.scrollTop||q.scrollLeft?h.animate(q,f.duration,f.easing,r):r();return!0},
fn:function(a){var b,e,h;b=[];var p=d(this);if(0===p.length)return this;a=d.extend({},c.config,a);e=p.parent();for(h=e.get(0);1===e.length&&h!==document.body&&h!==document;){var j;j="visible"!==e.css("overflow-y")&&h.scrollHeight!==h.clientHeight;h="visible"!==e.css("overflow-x")&&h.scrollWidth!==h.clientWidth;if(j||h)b.push({$container:e,$target:p}),p=e;e=e.parent();h=e.get(0)}b.push({$container:d(d.browser.msie||d.browser.mozilla?"html":"body"),$target:p});"all"===a.durationMode&&(a.duration/=b.length);
c.scroll(b,a);return this}};d.fn.ScrollTo=d.ScrollTo.fn})(window);function loadLessonPage(b){$.getJSON("api/thread.handler.php?act=get&lid="+lid+"&page="+b,function(a){totalThreads=a[0];currentPage=b;showLessonForum(a[1])})}
function showLessonForum(b){var a="";0==b.length&&(a='<div class="empty_message">\u8fd8\u6ca1\u6709\u4eba\u53d1\u5e16\uff0c\u5feb\u6765\u6210\u4e3a\u7b2c\u4e00\u4e2a\u53d1\u5e16\u7684\u5427\uff01</div>');for(var d=0;d<b.length;d++){var c=b[d],g=1==c.top,f=new strtotime(c.lastreply_time),e=f.getMonth()+1,h="",h=f.getMinutes();1==h.toString().length&&(h="0"+h);h=atToday(f)?f.getHours()+":"+h:atThisYear(f)?e+"-"+f.getDate():f.getFullYear()+"-"+e+"-"+f.getDate();a+='<div class="threadlist_wrap bdb">';
a+='<div class="number">'+c.view+"</div>";a+='<div class="number">'+c.reply+"</div>";a=g?a+('<div class="title"><a target="_blank" href="thread.php?tid='+c.tid+'">'+c.subject+'</a><img src="static/img/topthread.gif" alt="\u7f6e\u9876"></div>'):a+('<div class="title"><a target="_blank" href="thread.php?tid='+c.tid+'">'+c.subject+"</a></div>");a+='<div class="author"><a target="_blank" href="user.php?uxh='+c.uxh+'">'+c.uname+"</a></div>";a+='<div class="lastreply">'+h+' <a target="_blank" href="user.php?uxh='+
c.lastreply_uxh+'">'+c.lastreply_uname+"</a></div>";is_admin&&(a+='<div class="admin"><a class="clickable" onclick="deleteLessonThread('+c.tid+');">\u5220\u9664</a></div>');a+='<div class="clear"></div>';a+="</div>"}$("#threadlist").html(a);totalPages=Math.floor((totalThreads-1)/threadsPerPage+1);b="";d=1;a=totalPages;c=!1;5<currentPage&&(b=b+'<span class="button" onclick="jumpToLessonPage(1)">\u9996\u9875</span>'+('<span class="button" onclick="jumpToLessonPage('+(currentPage-1)+')">\u4e0a\u4e00\u9875</span>'),
d=currentPage-4);9<a-d&&(c=!0,a=d+9);for(;d<=a;d++)b=d!=currentPage?b+('<span class="button" onclick="jumpToLessonPage('+d+')">'+d+"</span>"):b+('<span class="normal" >'+d+"</span>");c&&(b+='<span class="button" onclick="jumpToLessonPage('+(currentPage+1)+')">\u4e0b\u4e00\u9875</span>',b+='<span class="button" onclick="jumpToLessonPage('+totalPages+')">\u5c3e\u9875</span>');$("#pager").html(b);$("#threadsnum").html("\u5171"+totalPages+"\u9875 \u5171\u6709\u4e3b\u9898\u6570:"+totalThreads)}
function jumpToLessonPage(b){$.getJSON("api/thread.handler.php?act=get&lid="+lid+"&page="+b,function(a){totalThreads=a[0];currentPage=b;showLessonForum(a[1]);$("#threadlist").ScrollTo()})}function refreshLessonForum(){loadLessonPage(currentPage)}
function newThread(){var b=$("#newthread_subject").val(),a=$("#newthread_content").val();""==b.length?alert("\u6807\u9898\u4e3a\u7a7a"):80<b.length?alert("\u6807\u9898\u8fc7\u957f\uff01"):""==a.length?alert("\u5185\u5bb9\u4e3a\u7a7a"):1024<a.length?alert("\u5185\u5bb9\u8fc7\u957f\uff01"):($("#submit_button").html("\u63d0\u4ea4\u4e2d..."),$("#submit_button").attr("disabled",!0),$.post("api/thread.handler.php?act=new",{s:b,c:a,l:lid}).done(function(a){0==a.lastIndexOf("0",0)?(a=a.substr(2),window.location.href=
"thread.php?tid="+a):(0==a.lastIndexOf("1",0)&&alert(a.substr(2)),$("#submit_button").html("\u63d0\u4ea4"),$("#submit_button").attr("disabled",!1))}))}function deleteLessonThread(b){confirm("\u786e\u5b9a\u5220\u9664\u5e16\u5b50\uff1f\uff08ID:"+b+"\uff09")&&$.get("api/thread.handler.php?act=delete&tid="+b,function(a){0==a.lastIndexOf("0",0)?refreshLessonForum():0==a.lastIndexOf("1",0)&&alert(a.substr(2))})}
function showOrHideLessonmate(){(showLessonmate=!showLessonmate)?(0==lessonmatePage&&(lessonmatePage=1,loadLessonmates()),$(".lesson_content").css("width","720px"),$(".lesson_content .title").css("width","445px"),$("#lessonmate_block").css("display","block")):($(".lesson_content").css("width","874px"),$(".lesson_content .title").css("width","590px"),$("#lessonmate_block").css("display","none"))}
function loadLessonmates(){$.getJSON("api/getlessonmates.php?lid="+lid+"&page="+lessonmatePage,function(b){showLessonmates(b)})}
function showLessonmates(b){for(var a="",d=0;d<b.length;d++){var c=b[d],g=1==c.registered,a=a+(g?'<div class="lessonmatelist_wrap_registered bdl bdr bdb" title="TA\u4e5f\u5728\u8bfe\u53cb\u7f51\u54e6\uff0c\u70b9\u51fb\u8fdb\u5165TA\u7684\u4e3b\u9875">':'<div class="lessonmatelist_wrap bdl bdr bdb" title="TA\u8fd8\u6ca1\u6709\u5728\u8bfe\u53cb\u7f51\u6ce8\u518c\uff0c\u5feb\u9080\u8bf7TA\u5427\uff01">');g?(a+='<span class="fl"><a target="_blank" href="user.php?uxh='+c.xh+'"><img src="'+getAvatarURL(c.xh,
1==c.has_avatar)+'" style="max-width:35px;max-height:35px;"></a></span>',a+='<span class="fl"><a target="_blank" href="user.php?uxh='+c.xh+'">'+c.xm+"</a></span>"):a+='<span class="fl">'+c.xm+"</span>";a+='<span title="'+c.zy+'\u4e13\u4e1a" class="bj fr">'+c.bj+"</span>";a+='<div class="clear"></div>';a+="</div>"}b.length==lessonmatesPerPage?$("#lessonmatePager").html('<span class="button" onclick="loadMoreLessonmates();">\u52a0\u8f7d\u66f4\u591a</span>'):$("#lessonmatePager").html("");1==lessonmatePage?
$("#lessonmatelist").html(a):1<lessonmatePage&&$("#lessonmatelist").append(a)}function loadMoreLessonmates(){lessonmatePage++;loadLessonmates()};function loadMessage(){$.getJSON("api/notice.handler.php?act=getmessage&page="+messagePage,function(b){showMessage(b)})}
function showMessage(b){var a="";0==b.length&&1==messagePage&&(a='<div class="empty_message">\u6536\u4ef6\u7bb1\u4e3a\u7a7a</div>');for(var d=0;d<b.length;d++)var c=b[d],g="0"==c.read?!1:!0,a=a+('<div class="messagelist_wrap bdb" id="mid'+c.mid+'">'),a=a+('<div class="avatar fl"><a target="_blank" href="user.php?uxh='+c.from_uxh+'"><img src="'+getAvatarURL(c.from_uxh,"1"==c.has_avatar)+'" style="max-width:35px;max-height:35px;"></a></div>'),a=a+('<div class="uname fl"><a target="_blank" href="user.php?uxh='+
c.from_uxh+'">'+c.uname+"</a><br />"+c.post_time+"</div>"),a=g?a+('<div class="title fl" onclick=""><a href="javascript:toggleMessage('+c.mid+')">'+c.title+"</a></div>"):a+('<div class="titlebold fl"><a href="javascript:expandMessage('+c.mid+')">'+c.title+"</a></div>"),a=a+('<div class="action fl"><span class="button" onclick="showPmdiv('+c.from_uxh+", '"+c.uname+'\')">\u53d1\u6d88\u606f</span><span class="button" onclick="deleteMessage('+c.mid+')">\u5220\u9664</span></div>'),a=a+'<div class="clear"></div>',
a=a+('<div class="content" style="display:none;">'+c.content+"</div>"),a=a+"</div>";b.length==messagesPerPage?$("#pager").html('<span class="button" onclick="loadMoreMessage();">\u52a0\u8f7d\u66f4\u591a</span>'):$("#pager").html("");1==messagePage?$("#messagelist").html(a):$("#messagelist").append(a)}
function expandMessage(b){$("#mid"+b+" .titlebold").addClass("title");$("#mid"+b+" .title").removeClass("titlebold");$("#mid"+b+" .content").show();$("#mid"+b+" .title a").attr("href","javascript:void(0)")}function toggleMessage(b){$("#mid"+b+" .content").toggle()}function loadMoreMessage(){messagePage++;loadMessage()}function deleteMessage(b){confirm("\u786e\u5b9a\u5220\u9664\u6d88\u606f\uff1f")&&$.get("api/notice.handler.php?act=deletemessage&mid="+b,function(){messagePage=1;loadMessage()})};function loadNotice(){$.getJSON("api/notice.handler.php?act=getnotice&page="+noticePage,function(b){showNotice(b)})}
function showNotice(b){var a="";0==b.length&&1==noticePage&&(a='<div class="empty_message">\u6682\u65e0\u63d0\u9192</div>');for(var d=0;d<b.length;d++){var c=b[d],g="0"==c.read?!1:!0,a=a+('<div class="noticelist_wrap bdb" id="nid'+c.nid+'">'),a=a+('<div class="avatar fl"><a target="_blank" href="user.php?uxh='+c.from_uxh+'"><img src="'+getAvatarURL(c.from_uxh,"1"==c.has_avatar)+'" style="max-width:35px;max-height:35px;"></a></div>'),a=a+('<div class="uname fl"><a target="_blank" href="user.php?uxh='+
c.from_uxh+'">'+c.uname+"</a><br />"+c.post_time+"</div>");"reply"==c.type&&(a=g?a+('<div class="title fl" onclick=""><a target="_blank"href="thread.php?tid='+c.tid+"&pid="+c.pid+'">\u6211\u56de\u590d\u4e86\u4f60\u7684\u5e16\u5b50\u201c'+c.subject+"\u201d\uff0c\u5feb\u53bb\u770b\u770b\u5427</a></div>"):a+('<div class="titlebold fl"><a target="_blank"href="thread.php?tid='+c.tid+"&pid="+c.pid+'">\u6211\u56de\u590d\u4e86\u4f60\u7684\u5e16\u5b50\u201c'+c.subject+"\u201d\uff0c\u5feb\u53bb\u770b\u770b\u5427</a></div>"));
a+='<div class="clear"></div>';a+="</div>"}b.length==noticesPerPage?$("#pager").html('<span class="button" onclick="loadMoreNotice();">\u52a0\u8f7d\u66f4\u591a</span>'):$("#pager").html("");1==noticePage?$("#noticelist").html(a):1<noticePage&&$("#noticelist").append(a)}function loadMoreNotice(){noticePage++;loadNotice()};function setSignature(){var b=$("#signature").val();255<b.length?alert("\u7b7e\u540d\u8fc7\u957f\uff08\u5927\u4e8e255\u4e2a\u5b57\u7b26\uff09\uff01"):$.post("api/user.handler.php?act=setsignature",{s:b}).done(function(a){"0"==a?alert("\u8bbe\u7f6e\u6210\u529f\uff01"):0==a.lastIndexOf("1",0)&&alert(a.substr(2))})}
function uploadAvatar(){var b=$("#avatar_file").val();if(!b)return!1;b=b.split(".");if(1>=b.length)return alert("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u6587\u4ef6\u540d"),!1;if(!{jpg:1,jpeg:1,gif:1,png:1}[b[b.length-1].toLowerCase()])return alert("\u62b1\u6b49\uff0c\u76ee\u524d\u4ec5\u652f\u6301\u683c\u5f0f\u4e3ajpg\u3001jpeg\u3001gif\u3001png\u7684\u56fe\u7247"),!1;$.ajaxFileUpload({url:"api/uploadavatar.php",secureuri:!1,fileElementId:"avatar_file",dataType:"text",success:function(a){0==a?(alert("\u4e0a\u4f20\u6210\u529f\uff01"),
window.location.reload()):0==a.lastIndexOf("1",0)&&alert(a.substr(2))}})};function checkRegisterForm(){var b=document.getElementById("register_form"),a=b.xh.value,d=b.password.value,b=b.confirm_password.value;isNaN(a)||9!=a.length?alert("\u8bf7\u68c0\u67e5\u8f93\u5165\u7684\u5b66\u53f7\u662f\u5426\u6709\u8bef"):6>d.length?alert("\u5bc6\u7801\u8fc7\u77ed\uff01\uff08\u5c11\u4e8e6\u4e2a\u5b57\u7b26\uff09"):d!=b?alert("\u4e24\u6b21\u8f93\u5165\u7684\u5bc6\u7801\u4e0d\u4e00\u81f4\uff01"):($("#submit_button").html("\u63d0\u4ea4\u4e2d..."),$("#submit_button").attr("disabled",
!0),$.post("api/user.handler.php?act=register",{x:a,p:d}).done(function(a){0==a.lastIndexOf("0",0)?($.cookie("ck",a.substr(2)),window.location.href="index.php"):(0==a.lastIndexOf("1",0)&&alert(a.substr(2)),$("#submit_button").html("\u63d0\u4ea4"),$("#submit_button").attr("disabled",!1))}))};function loadThreadPage(b,a){$.getJSON("api/post.handler.php?act=get&tid="+tid+"&page="+b,function(d){totalPosts=d[0];currentPage=b;showThread(d[1]);a="undefined"!==typeof a?a:!1;!1!=a&&scrollToPost(a)})}
function showThread(b){for(var a="",d=0;d<b.length;d++){var c=b[d],a=a+('<div class="post_wrap" id="pid'+c.pid+'">'),a=a+'<div class="post_author">',a=a+'<div class="post_author_icon">',a=a+('<a target="_blank" href="user.php?uxh='+c.uxh+'"><img src="'+getAvatarURL(c.uxh,"1"==c.has_avatar)+'" ></a>'),a=a+"</div>",a=a+'<div class="post_author_name">',a=a+('<a target="_blank" href="user.php?uxh='+c.uxh+'">'+c.uname+"</a>"),a=a+"</div>",a=a+"</div>",a=a+'<div class="post_content_main">',a=a+('<div class="post_content_text">'+
c.content+"</div>"),a=a+'<div class="post_content_info">';is_admin&&(a+='<span class="admin"><a class="clickable" onclick="deletePost('+c.pid+');">\u5220\u9664</a></span>');"1"==c.from_client&&(a+='<span>\u6765\u81ea<a target="_blank" href="android.php">Android\u7248</a></span>');a+="<span>"+c.floor+"\u697c</span>";a+="<span>"+c.post_time+"</span>";a+="</div>";a+="</div>";a+='<div class="clear">';a+="</div>";a+="</div>"}$("#postlist").html(a);totalPages=Math.floor((totalPosts-1)/postsPerPage+1);b=
"";d=1;a=totalPages;c=!1;5<currentPage&&(b=b+'<span class="button" onclick="jumpToThreadPage(1)">\u9996\u9875</span>'+('<span class="button" onclick="jumpToThreadPage('+(currentPage-1)+')">\u4e0a\u4e00\u9875</span>'),d=currentPage-4);9<a-d&&(c=!0,a=d+9);for(;d<=a;d++)b=d!=currentPage?b+('<span class="button" onclick="jumpToThreadPage('+d+')">'+d+"</span>"):b+('<span class="normal" >'+d+"</span>");c&&(b+='<span class="button" onclick="jumpToThreadPage('+(currentPage+1)+')">\u4e0b\u4e00\u9875</span>',
b+='<span class="button" onclick="jumpToThreadPage('+totalPages+')">\u5c3e\u9875</span>');$("#pager").html(b);$("#postsnum").html("\u5171"+totalPages+"\u9875 \u56de\u590d\u5e16:"+(totalPosts-1))}function jumpToThreadPage(b){$.getJSON("api/post.handler.php?act=get&tid="+tid+"&page="+b,function(a){totalPosts=a[0];currentPage=b;showThread(a[1]);$("#postlist").ScrollTo()})}function refreshThread(){loadThreadPage(currentPage)}
function newPost(){var b=$("#newpost_content").val();""==b.length?alert("\u5185\u5bb9\u4e3a\u7a7a"):1024<b.length?alert("\u5185\u5bb9\u8fc7\u957f\uff01"):($("#submit_button").html("\u63d0\u4ea4\u4e2d..."),$("#submit_button").attr("disabled",!0),$.post("api/post.handler.php?act=new",{c:b,t:tid}).done(function(a){0==a.lastIndexOf("0",0)?($("#newpost_content").val(""),a=a.substr(2),window.location.href="thread.php?tid="+tid+"&pid="+a):(0==a.lastIndexOf("1",0)&&alert(a.substr(2)),$("#submit_button").html("\u63d0\u4ea4"),
$("#submit_button").attr("disabled",!1))}))}function scrollToPost(b){$("#pid"+b).ScrollTo()}function deletePost(b){confirm("\u786e\u5b9a\u5220\u9664\u56de\u590d\u5e16\uff1f")&&$.get("api/post.handler.php?act=delete&pid="+b,function(a){0==a.lastIndexOf("0",0)?refreshThread():0==a.lastIndexOf("1",0)&&alert(a.substr(2))})}function setThreadTop(b){$.get("api/thread.handler.php?act=settop&tid="+tid+"&value="+b,function(a){""==a&&alert("done!")})};function loadTimetable(){showLoading();$.getJSON("api/getlessons.php?xh="+xh,function(b){showTimetable(b)})}function showLoading(){$("#loading_timetable").html("\u6b63\u5728\u8f7d\u5165\u8bfe\u7a0b...");$("#loading_timetable").css("display","block");$("#timetable").css("display","none")}function hideLoading(){$("#timetable").css("display","block");$("#loading_timetable").css("display","none")}var weekNames="\u661f\u671f\u4e00 \u661f\u671f\u4e8c \u661f\u671f\u4e09 \u661f\u671f\u56db \u661f\u671f\u4e94 \u661f\u671f\u516d \u661f\u671f\u65e5".split(" ");
function showTimetable(b){if(null==b)$("#loading_timetable").html("\u83b7\u53d6\u8bfe\u8868\u5931\u8d25...");else{for(var a="<tr>",d=0;7>d;d++)a+="<th>",a+=weekNames[d],a+="</th>";for(var a=a+"</tr>",c="<tr>",g="",f=0;5>f;f++){for(d=0;7>d;d++){c+="<td>";if("undefined"!=typeof b[d]&&"undefined"!=typeof b[d][f]){var e=b[d][f],c=c+('<div title="\u70b9\u51fb\u8fdb\u5165\u8bfe\u7a0b\u8ba8\u8bba" class="lessongrid" onclick="openLessonForum(\''+e.lid+"');\">"),c=c+('<div class="lessonname">'+e.lessonname+
"</div>"),c=c+('<div class="teachername">'+e.teachername+"</div>"),c=c+('<div class="place">'+e.place+"</div>"),c=c+"</div>";""==g&&(g=e.xm)}c+="</div></td>"}c+="</tr>"}$("#timetable_name").html(g+"\u7684\u8bfe\u8868");$("#timetable").html(a+c);hideLoading()}}function refreshTimetable(){xh=$("#xh").val();loadTimetable(xh)}function openLessonForum(b){window.location.href="lesson.php?lid="+b};
